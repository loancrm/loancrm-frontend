<!-- <div *ngIf="loading">
  <app-preloader></app-preloader>
</div>

<div
  *ngIf="!loading && selectedReportConfig && selectedReportConfig.fields"
  class="no-select"
>
  <div class="card">
    <div (click)="goBack()" class="pointer-cursor">
      <span><i class="pi pi-arrow-left fw-bold"></i></span>&nbsp;
      <span
        *ngIf="selectedReportConfig.reportName"
        class="back-btn-text fw-bold"
        >{{ selectedReportConfig.reportName }} Report</span
      >
    </div>
  </div>

  <div>
    <p-breadcrumb [model]="breadCrumbItems"></p-breadcrumb>
  </div>
  <div class="card report-fields mt-2">
    <div class="row">
      <ng-container
        class="create mt-1"
        *ngFor="let field of selectedReportConfig.fields; let i = index"
      >
        <div class="col-xl-3 col-md-4 col-sm-6 mt-2">
          <label [htmlFor]="field.field" *ngIf="!field.disabled">{{
            field.title
          }}</label>
          <input
            pInputText
            [id]="field.field"
            [placeholder]="'Enter ' + field.title"
            autocomplete="off"
            [(ngModel)]="reportData[field.field + '-' + field.filterType]"
            *ngIf="field && field.type == 'text'"
            [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
          />
          <input
            pInputText
            [id]="field.field"
            [placeholder]="'Enter ' + field.title"
            autocomplete="off"
            [(ngModel)]="reportData[field.field + '-' + field.filterType]"
            *ngIf="field && field.type == 'number'"
            [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
            (keypress)="onNumberInputChange($event)"
          />
          <span *ngIf="field && field.type == 'date'">
            <p-calendar
              [placeholder]="'Select ' + field.title"
              appendTo="body"
              [showIcon]="true"
              [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
              [dateFormat]="field.dateFormat ? field.dateFormat : 'dd/mm/yy'"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [readonlyInput]="true"
            ></p-calendar>
          </span>
          <span *ngIf="field && field.type == 'dropdown'">
            <p-dropdown
              [placeholder]="'Select ' + field.title"
              styleClass="text-left"
              [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
              [options]="field.options"
              [optionValue]="field.value"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [optionLabel]="field.label"
              appendTo="body"
              [dropdownIcon]="'fa fa-caret-down'"
              [autoDisplayFirst]="field.autoDisplayFirst ? true : false"
              [filter]="field.showFilter ? true : false"
            >
            </p-dropdown>
          </span>
          <span *ngIf="field && field.type == 'timePeriod' && !field.disabled">
            <p-dropdown
              [placeholder]="'Select ' + field.title"
              styleClass="text-left"
              [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
              [options]="field.options"
              [optionValue]="field.value"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [optionLabel]="field.label"
              appendTo="body"
              [dropdownIcon]="'fa fa-caret-down'"
              [autoDisplayFirst]="false"
              [filter]="field.showFilter ? true : false"
              (onChange)="onTimePeriodChange($event, field, i)"
              [disabled]="field.disabled"
            >
            </p-dropdown>
          </span>

          <span *ngIf="field && field.type == 'multiselect'">
            <p-multiSelect
              [placeholder]="'Select ' + field.title"
              styleClass="text-left"
              [style]="{ width: field.fieldWidth ? field.fieldWidth : '100%' }"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [dropdownIcon]="'fa fa-caret-down'"
              [options]="field.options"
              appendTo="body"
              [optionValue]="field.value"
              [optionLabel]="field.label"
            ></p-multiSelect>
          </span>
          <span *ngIf="field && field.type == 'page'">
            <div class="d-flex">
              <div class="flex-grow-1 right-border-rad">
                <input
                  pInputText
                  [class.disable-field]="true"
                  [placeholder]="'Select ' + field.title"
                  autocomplete="off"
                  [value]="
                    getLabelsFromData(
                      field,
                      reportData[field.field + '-' + field.filterType]
                    )
                  "
                  [style]="{
                    width: field.fieldWidth ? field.fieldWidth : '100%'
                  }"
                />
              </div>
              <div class="create d-flex left-border-rad">
                <button pButton pRipple class="btn btn-primary">Change</button>
              </div>
            </div>
          </span>
        </div>
      </ng-container>
    </div>
    <div class="mt-3 text-center">
      <div class="d-md-flex justify-content-center">
        <div class="mt-2">
          <button
            pButton
            pRipple
            class="p-button-primary me-2"
            (click)="generateReport(selectedReportConfig.reportType)"
          >
            Generate Report
          </button>
        </div>
      </div>
    </div>
  </div>
</div> -->

<div *ngIf="loading">
  <app-preloader></app-preloader>
</div>

<div
  *ngIf="!loading && selectedReportConfig && selectedReportConfig.fields"
  class="no-select"
>
  <!-- Breadcrumb & Back -->
  <div class="bread-crumb m-2">
    <p-breadcrumb [model]="breadCrumbItems"></p-breadcrumb>
  </div>

  <div class="p-1 m-2">
    <div class="d-flex justify-content-between">
      <!-- Back Button -->
      <div
        (click)="goBack()"
        class="d-flex align-items-center justify-content-center pointer-cursor"
      >
        <span class="me-2 d-flex align-items-center">
          <img src="../../../assets/images/icons/left-arrow.svg" alt="Back" />
        </span>
        <b>
          <span
            *ngIf="selectedReportConfig.reportName"
            class="back-btn-text fw-bold"
          >
            {{ selectedReportConfig.reportName }} Report
          </span>
        </b>
      </div>

      <!-- âœ… Loan Type Dropdown (now supports more report types) -->
      <div
        class="m-2"
        *ngIf="
          [
            'LEADS',
            'LOANLEADS',
            'CALLBACKS',
            'FILESINPROCESS',
            'SANCTIONFILES',
            'DISBURSALFILES',
            'BANKREJECTEDFILES',
            'CNIFILES',
            'CNIDETAILS',
            'SANCTIONDETAILS',
            'LOGINSDONEDETAILS',
            'DISBURSALDETAILS',
            'LOGINFILES'
          ].includes(reportType)
        "
      >
        <label for="loanTypeSelect" class="fw-bold">Select Loan Type:</label>
        <p-dropdown
          [options]="loanTypes"
          [(ngModel)]="selectedLoanType"
          optionLabel="label"
          optionValue="value"
          placeholder="Choose Loan Type"
          (onChange)="onLoanTypeChange($event)"
          class="w-25"
        ></p-dropdown>
      </div>
    </div>
  </div>

  <!-- Ask for Employment Status -->
  <div
    *ngIf="showEmploymentSelector && !selectedEmploymentStatus"
    class="m-2 w-100 text-center"
  >
    <div class="card p-3">
      <h5>Select Employment Status</h5>
      <div class="d-flex justify-content-center gap-3 mt-2">
        <button
          pButton
          class="p-button-primary"
          *ngFor="let status of employmentStatuses"
          (click)="onEmploymentStatusSelect(status.value)"
        >
          {{ status.label }}
        </button>
      </div>
    </div>
  </div>

  <!-- Report Filters Form -->
  <div
    class="card report-fields m-2"
    *ngIf="!showEmploymentSelector || selectedEmploymentStatus"
  >
    <div class="row">
      <ng-container
        *ngFor="let field of selectedReportConfig.fields; let i = index"
      >
        <div class="col-xl-3 col-md-4 col-sm-6 mt-2">
          <label [htmlFor]="field.field" *ngIf="!field.disabled">{{
            field.title
          }}</label>

          <!-- Text Field -->
          <input
            pInputText
            [id]="field.field"
            [placeholder]="'Enter ' + field.title"
            [(ngModel)]="reportData[field.field + '-' + field.filterType]"
            *ngIf="field?.type === 'text'"
            [style]="{ width: field.fieldWidth || '100%' }"
          />

          <!-- Number Field -->
          <input
            pInputText
            [id]="field.field"
            [placeholder]="'Enter ' + field.title"
            [(ngModel)]="reportData[field.field + '-' + field.filterType]"
            *ngIf="field?.type === 'number'"
            [style]="{ width: field.fieldWidth || '100%' }"
            (keypress)="onNumberInputChange($event)"
          />

          <!-- Date Field -->
          <span *ngIf="field?.type === 'date'">
            <div class="custom-calendar-wrapper w-100 position-relative">
              <p-calendar
                #calendar
                [placeholder]="'Select ' + field.title"
                appendTo="body"
                [showIcon]="false"
                [style]="{ width: field.fieldWidth || '100%' }"
                [dateFormat]="field.dateFormat || 'dd/mm/yy'"
                [(ngModel)]="reportData[field.field + '-' + field.filterType]"
                [readonlyInput]="true"
                [showButtonBar]="true"
              ></p-calendar>
              <img
                src="../../../../assets/images/icons/calendar.svg"
                alt="Calendar Icon"
                class="calendar-custom-img"
                (click)="calendar.toggle()"
              />
            </div>
          </span>

          <!-- Dropdown -->
          <span *ngIf="field?.type === 'dropdown'">
            <p-multiSelect
              [placeholder]="'Select ' + field.title"
              [options]="field.options"
              [optionLabel]="field.label"
              [optionValue]="field.value"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [style]="{ width: field.fieldWidth || '100%' }"
              appendTo="body"
              [showClear]="true"
              [filter]="true"
              filterPlaceholder="Search..."
            ></p-multiSelect>
          </span>

          <!-- Time Period -->
          <span *ngIf="field?.type === 'timePeriod'">
            <p-dropdown
              [placeholder]="'Select ' + field.title"
              [options]="field.options"
              [optionLabel]="field.label"
              [optionValue]="field.value"
              [(ngModel)]="reportData[field.field + '-' + field.filterType]"
              [style]="{ width: field.fieldWidth || '100%' }"
              [dropdownIcon]="'fa fa-caret-down'"
              [autoDisplayFirst]="false"
              appendTo="body"
              (onChange)="onTimePeriodChange($event, field, i)"
            >
            </p-dropdown>
          </span>

          <!-- Page Field -->
          <span *ngIf="field?.type === 'page'">
            <div class="d-flex">
              <div class="flex-grow-1 right-border-rad">
                <input
                  pInputText
                  class="disable-field"
                  [placeholder]="'Select ' + field.title"
                  [value]="
                    getLabelsFromData(
                      field,
                      reportData[field.field + '-' + field.filterType]
                    )
                  "
                  [style]="{ width: field.fieldWidth || '100%' }"
                />
              </div>
              <div class="create d-flex left-border-rad">
                <button pButton class="btn btn-primary">Change</button>
              </div>
            </div>
          </span>
        </div>
      </ng-container>
    </div>

    <!-- Submit Button -->
    <div class="mt-3 text-center">
      <div class="d-md-flex justify-content-center">
        <div class="mt-2">
          <button
            pButton
            class="p-button-primary me-2"
            (click)="generateReport(selectedReportConfig.reportType)"
          >
            Generate Report
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
