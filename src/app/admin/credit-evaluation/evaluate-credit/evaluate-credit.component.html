<div class="main-section">
  <!-- Breadcrumb -->
  <div class="bread-crumb mb-3">
    <p-breadcrumb [model]="breadCrumbItems"></p-breadcrumb>
  </div>

  <!-- Back Button and Title -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center pointer-cursor" (click)="goBack()">
      <img src="../../../assets/images/icons/Vector.png" class="me-2" alt="Back" />
      <span  class="back-btn-text text-capitalize">
        {{ (leadData[0]?.businessName || 'Credit Assessment' || 'N/A') | capitalizeFirst }}
      </span>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="loading">
    <app-preloader></app-preloader>
  </div>

  <!-- Main Content -->
  <div class="row main-container" *ngIf="!loading">
    <!-- Stepper Sidebar -->
    <div class="col-md-3">
      <div class="stepper-box">
        <div
          *ngFor="let section of steps; let i = index"
          (click)="setSection(i)"
          class="stepper-item"
          [ngClass]="{ 'active': selectedSection === i }"
        >
          {{ section.label }}
        </div>
      </div>
    </div>

    <!-- Right Panel Content -->
    <div class="col-md-9">
      <div class="card card-section">
        <!-- Section: Business Information -->
        <div *ngIf="selectedSection === 0">
          <div class="row">
            <div class="col-md-3 g-3" *ngFor="let field of businessFields">
              <div class="field-box">
                <label>{{ field.label }}</label>
                <div class="field-value">
                  {{ leadData[0]?.[field.key] || '-' }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Uploaded Documents -->
        <div *ngIf="selectedSection === 1">
          <div class="row">

            <!-- Proprietorship -->
            <div *ngIf="leadData[0]?.businessEntity === 'proprietorship' && leadDocuments" class="detail-card">
              <div class="business-details">
                <div class="col-md-3 info-line" *ngFor="let doc of documentTypes">
                  <div class="label d-flex justify-content-between">
                    {{ doc.label }}
                  </div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.[doc.key]?.length > 0; else noData">
                      <span *ngFor="let file of leadDocuments[doc.key]" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                    <ng-template #noData>-</ng-template>
                  </div>
                </div>
              </div>
            </div>

            <!-- Partnership -->
            <div *ngIf="leadData[0]?.businessEntity === 'partnership' && leadDocuments" class="detail-card">
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">Firm PAN</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPan; else noValue">
                      {{ leadDocuments.firmPanCard[0].firmPan }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">PAN Card</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPanCard?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments.firmPanCard[0].firmPanCard" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div class="info-line" *ngFor="let doc of remainingFirmDocuments">
                  <div class="label d-flex justify-content-between">{{ doc.label }}</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments[doc.key]" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>

            <!-- LLP -->
            <div *ngIf="leadData[0]?.businessEntity === 'llp' && leadDocuments" class="detail-card">
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">Firm PAN Number</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPan; else noValue">
                      {{ leadDocuments.firmPanCard[0].firmPan }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">Firm PAN Card</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPanCard?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments.firmPanCard[0].firmPanCard" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div class="info-line" *ngFor="let doc of llpFirmDocuments">
                  <div class="label d-flex justify-content-between">{{ doc.label }}</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments[doc.key]" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>

            <!-- Private Limited -->
            <div *ngIf="leadData[0]?.businessEntity === 'privateLimited' && leadDocuments" class="detail-card">
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">Company PAN Number</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.companyPan?.[0]?.panNumber; else noValue">
                      {{ leadDocuments.companyPan[0].panNumber }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">Company PAN Card</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.companyPan?.[0]?.companyPan?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments.companyPan[0].companyPan" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div class="info-line" *ngFor="let doc of companyDocuments">
                  <div class="label d-flex justify-content-between">{{ doc.label }}</div>
                  <div class="value">
                    <ng-container *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue">
                      <span *ngFor="let file of leadDocuments[doc.key]" class="me-2">
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Existing Loans -->
        <div *ngIf="selectedSection === 2">
          <div *ngIf="leadDocuments?.existingLoans?.length > 0">
            <div *ngFor="let loan of leadDocuments.existingLoans; let i = index">
              <div class="mb-3">
                <h6 class="text-secondary">Loan {{ i + 1 }}</h6>
                <div class="row">
                  <div class="col-md-6" *ngFor="let field of existingLoanFields">
                    <div class="field-box">
                      <label>{{ field.label }}</label>
                      <div class="field-value">
                        <ng-container *ngIf="field.pipe === 'capitalize'">
                          {{ loan[field.key] ? (loan[field.key] | capitalizeFirst) : '-' }}
                        </ng-container>
                        <ng-container *ngIf="field.pipe === 'date'">
                          <ng-container *ngIf="isValidDate(loan[field.key]); else dash">
                            {{ loan[field.key] | date }}
                          </ng-container>
                        </ng-container>
                        <ng-container *ngIf="!field.pipe">
                          {{ loan[field.key] || '-' }}
                        </ng-container>
                        <ng-template #dash>-</ng-template>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="!leadDocuments?.existingLoans?.length">
            <p class="text-muted">No existing loan data available.</p>
          </div>
        </div>

        <!-- Section: DSCR Tabs -->
        <div *ngIf="selectedSection === 3">
          <!-- <h5 class="text-primary fw-bold mb-3">DSCR Ratio</h5> -->
          <div>

            <!-- DSCR Accordion -->
            <div class="accordion-item">
              <div class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#kycCollapse" aria-expanded="true" aria-controls="kycCollapse">
                  DSCR Calculation
                </button>
              </div>
              <div id="kycCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">

                  <!-- ITR Display -->
                  <div class="row mb-4" *ngIf="leadDocuments?.financialReturns; else noITR">
                    <div class="col-md-6 mb-3">
                      <p class="fw-semibold mb-1">Annual Year of ITR:</p>
                      <p>{{ leadDocuments?.financialReturns[0]?.pastIncomeTax || 'N/A' }}</p>
                      <p class="fw-semibold mb-1">Attachment:</p>
                      <div>
                        <ng-container *ngIf="leadDocuments?.financialReturns[0]?.pastIncomeReturns?.length > 0">
                          <a *ngFor="let file of leadDocuments?.financialReturns[0]?.pastIncomeReturns" [href]="'//' + file" target="_blank" class="me-2 text-primary text-decoration-underline">View</a>
                        </ng-container>
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <p class="fw-semibold mb-1">Annual Year of ITR:</p>
                      <p>{{ leadDocuments?.financialReturns[0]?.presentIncomeTax || 'N/A' }}</p>
                      <p class="fw-semibold mb-1">Attachment:</p>
                      <div>
                        <ng-container *ngIf="leadDocuments?.financialReturns[0]?.presentIncomeReturns?.length > 0">
                          <a *ngFor="let file of leadDocuments?.financialReturns[0]?.presentIncomeReturns" [href]="'//' + file" target="_blank" class="me-2 text-primary text-decoration-underline">View</a>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                  <ng-template #noITR>
                    <p style="color: #535AB4; font-weight: 500; font-size: 18px;">ITR Documents Not Uploaded</p>
                  </ng-template>

                  <!-- Profit & Loss Checkboxes -->
                  <p class="fw-bold text-decoration-underline mb-2">Profit and Loss Statement</p>
                        <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck1"
                      [(ngModel)]="isFirstYearSelected"
                    />
                    <label class="form-check-label" for="defaultCheck1">
                      {{ getFinancialYear() }}
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck2"
                      [(ngModel)]="isSecondYearSelected"
                    />
                    <label class="form-check-label" for="defaultCheck2">
                      {{ getFinancialYear(1) }}
                    </label>
                  </div>

                  <!-- First Year Inputs -->
                  <div *ngIf="isFirstYearSelected" class="mt-4">
                    <p class="fw-semibold mb-2" style="color: #535AB4; font-size: 20px;">{{ getFinancialYear() }}</p>
                    <div class="row g-3">
                      <div class="col-md-4" *ngFor="let field of [
                        { label: 'Turnover / Sales', model: turnoverAy1 },
                        { label: 'Purchases', model: purchasesAy1 },
                        { label: 'Profit After Tax', model: profitaftertaxAy1 },
                        { label: 'Depreciation', model: depreciationAy1 },
                        { label: 'Interest on Loans', model: interestonLoansAy1 },
                        { label: 'Enter No of Months', model: monthsAy1 }
                      ]">
                        <label class="form-label fw-semibold">{{ field.label }}</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="field.model" autocomplete="off" />
                      </div>

                      <!-- Conditional Fields -->
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'partnership'">
                        <label class="form-label fw-semibold">Partners Remuneration</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="partnerRemuAy1" autocomplete="off" />
                      </div>
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'partnership'">
                        <label class="form-label fw-semibold">Interest on Partners Capital</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="partnerInterestAy1" autocomplete="off" />
                      </div>
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'privateLimited'">
                        <label class="form-label fw-semibold">Directors Remuneration</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="directorsRemuAy1" autocomplete="off" />
                      </div>
                    </div>
                  </div>

                  <!-- Second Year Inputs -->
                  <div *ngIf="isSecondYearSelected" class="mt-4">
                    <p class="fw-semibold text-decoration-underline mb-2">{{ getFinancialYear(1) }}</p>
                    <div class="row g-3">
                      <div class="col-md-4" *ngFor="let field of [
                        { label: 'Turnover / Sales', model: turnoverAy2 },
                        { label: 'Purchases', model: purchasesAy2 },
                        { label: 'Profit After Tax', model: profitaftertaxAy2 },
                        { label: 'Depreciation', model: depreciationAy2 },
                        { label: 'Interest on Loans', model: interestonLoansAy2 }
                      ]">
                        <label class="form-label fw-semibold">{{ field.label }}</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="field.model" autocomplete="off" />
                      </div>

                      <!-- Conditional Fields -->
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'partnership'">
                        <label class="form-label fw-semibold">Partners Remuneration</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="partnerRemuAy2" autocomplete="off" />
                      </div>
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'partnership'">
                        <label class="form-label fw-semibold">Interest on Partners Capital</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="partnerInterestAy2" autocomplete="off" />
                      </div>
                      <div class="col-md-4" *ngIf="leadData[0]?.businessEntity == 'privateLimited'">
                        <label class="form-label fw-semibold">Directors Remuneration</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="directorsRemuAy2" autocomplete="off" />
                      </div>
                    </div>
                  </div>

                  <!-- Additional Fields -->
                  <hr class="my-4" />
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label fw-semibold">Total EMI</label>
                      <input pInputText type="number" class="form-control" [(ngModel)]="totalEmi" autocomplete="off" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-semibold">Proposed EMI</label>
                      <input pInputText type="number" class="form-control" [(ngModel)]="proposedEmi" autocomplete="off" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-semibold">OD/CC Interest</label>
                      <input pInputText type="number" class="form-control" [(ngModel)]="odCcInterestAy1" autocomplete="off" />
                    </div>
                  </div>

                  <!-- Calculate Button -->
                  <div class="text-center mt-4">
                    <button pButton type="button" class="p-button p-button-primary px-4" (click)="calculateDscrRatio()">
                      Calculate
                    </button>
                  </div>

                  <!-- Result -->
                  <div class="text-center mt-3 fw-bold">
                    Result for {{ getFinancialYear() }}:
                    <span class="text-primary ms-1">{{ resultFirstYear }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Balance Sheet Accordion -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#supportingCollapse" aria-expanded="true" aria-controls="supportingCollapse">
                  Balance Sheet
                </button>
              </h2>
              <div id="supportingCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value=""
                id="defaultCheck1"
                [(ngModel)]="isFirstYearBalanceSheet"
              />
              <label class="form-check-label" for="defaultCheck1">
                {{ getFinancialYear() }}
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value=""
                id="defaultCheck2"
                [(ngModel)]="isSecondYearBalanceSheet"
              />
              <label class="form-check-label" for="defaultCheck2">
                {{ getFinancialYear(1) }}
              </label>
            </div>

                  <!-- First Year BS -->
                  <div *ngIf="isFirstYearBalanceSheet" class="mt-4">
                    <p class="fw-semibold text-decoration-underline mb-2">{{ getFinancialYear() }}</p>
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label fw-semibold">Sundry Debtors</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="sundryDebtorsAy1" />
                      </div>
                      <div class="col-md-4">
                        <label class="form-label fw-semibold">Sundry Creditors</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="sundryCreditorsAy1" />
                      </div>
                    </div>
                  </div>

                  <!-- Second Year BS -->
                  <div *ngIf="isSecondYearBalanceSheet" class="mt-4">
                    <p class="fw-semibold text-decoration-underline mb-2">{{ getFinancialYear(1) }}</p>
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label fw-semibold">Sundry Debtors</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="sundryDebtorsAy2" placeholder="Enter Sundry Debtors" />
                      </div>
                      <div class="col-md-4">
                        <label class="form-label fw-semibold">Sundry Creditors</label>
                        <input pInputText type="number" class="form-control" [(ngModel)]="sundryCreditorsAy2" placeholder="Enter Sundry Creditors" />
                      </div>
                    </div>
                  </div>

                  <div class="text-center mt-4">
                    <button pButton type="button" class="p-button p-button-primary px-4" (click)="calculateBalanceSheet()">
                      Calculate
                    </button>
                  </div>

                  <div class="mt-3 text-center fw-bold">
                    <p>Debtor Days for {{ getFinancialYear() }}: <span class="text-primary">{{ debtor_daysFirstYear }}</span></p>
                    <p>Creditor Days for {{ getFinancialYear() }}: <span class="text-primary">{{ creditor_daysFirstYear }}</span></p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!---Section: BTO Program-->
        <div *ngIf="selectedSection === 4">
          <!-- <h5 class="text-primary">BTO Program</h5> -->
          <div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#kycCollapse" aria-expanded="true" aria-controls="kycCollapse">
                  BTO Calculation
                </button>
              </h2>
              <div id="kycCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div>
                    <div class="detail-card">
                      <!-- <div *ngIf="leadDocuments?.currentAccountStatements?.length > 0">
                    <div
                      *ngFor="
                        let account of leadDocuments?.currentAccountStatements;
                        let i = index
                      "
                      class="business-details mt-3"
                    >
                      <div class="label" style="text-decoration: underline">
                        Current Account-{{ i + 1 }}
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Bank Name<b>:&nbsp;</b>
                        </div>
                        <div class="value">
                          {{ account.name | capitalizeFirst }}
                        </div>
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement From<b>:&nbsp;</b>
                        </div>
                        <div *ngIf="isValidDate(account.from)" class="value">
                          {{ account.from | date }}
                        </div>
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement To<b>:&nbsp;</b>
                        </div>
                        <div *ngIf="isValidDate(account.to)" class="value">
                          {{ account.to | date }}
                        </div>
                      </div>
                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement Attachement<b>:&nbsp;</b>
                        </div>
                        <div class="value">
                          <div
                            *ngIf="
                              account?.currentAccountStatements &&
                              account?.currentAccountStatements.length > 0
                            "
                          >
                            <span
                              *ngFor="let file of account?.currentAccountStatements"
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank"> View </a>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> -->

                      <!-- <div class="scrollable-content">
                      <div
                        *ngIf="leadDocuments?.currentAccountStatements?.length > 0"
                      >
                        <div
                          *ngFor="
                            let account of leadDocuments.currentAccountStatements;
                            let i = index
                          "
                          class="business-details mt-3"
                        >
                          <div class="label" style="text-decoration: underline">
                            Current Account - {{ i + 1 }}
                          </div>
                          <div
                            class="info-line"
                            *ngFor="let field of currentAccountFields"
                          >
                            <div class="label d-flex justify-content-between">
                              {{ field.label }} <b>:&nbsp;</b>
                            </div>
                            <div class="value">
                              <ng-container *ngIf="field.isDate">
                                <ng-container
                                  *ngIf="
                                    isValidDate(account[field.key]);
                                    else noValue
                                  "
                                >
                                  {{ account[field.key] | date }}
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.pipe === 'capitalize'">
                                {{
                                  account[field.key]
                                    ? (account[field.key] | capitalizeFirst)
                                    : "-"
                                }}
                              </ng-container>

                              <ng-container
                                *ngIf="
                                  !field.isDate &&
                                  !field.pipe &&
                                  field.key !== 'currentAccountStatements'
                                "
                              >
                                {{ account[field.key] || "-" }}
                              </ng-container>

                              <ng-container
                                *ngIf="field.key === 'currentAccountStatements'"
                              >
                                <ng-container
                                  *ngIf="
                                    account?.currentAccountStatements?.length > 0;
                                    else noValue
                                  "
                                >
                                  <span
                                    *ngFor="
                                      let file of account.currentAccountStatements
                                    "
                                    class="me-2"
                                  >
                                    <a [href]="'//' + file" target="_blank">View</a>
                                  </span>
                                </ng-container>
                              </ng-container>
                            </div>
                          </div>

                          <ng-template #noValue>-</ng-template>
                        </div>
                      </div>
                    </div> -->

                      <div
                        *ngIf="leadDocuments?.currentAccountStatements?.length > 0"
                      >
                        <p-table
                          [value]="leadDocuments?.currentAccountStatements"
                          responsiveLayout="scroll"
                          class="custom-dark-table"
                        >
                          <!-- Header Template -->
                          <ng-template pTemplate="header">
                            <tr>
                              <th>Bank Name</th>
                              <th>From Date</th>
                              <th>To Date</th>
                              <th>Files</th>
                            </tr>
                          </ng-template>

                          <!-- Body Template -->
                          <ng-template let-stmt pTemplate="body">
                            <tr>
                              <td>{{ stmt.name }}</td>
                              <td>
                                {{
                                  isValidDate(stmt.from)
                                    ? (stmt.from | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                {{
                                  isValidDate(stmt.to)
                                    ? (stmt.to | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                <div class="p-d-flex p-flex-wrap p-gap-2">
                                  <a
                                    *ngFor="
                                      let file of stmt.currentAccountStatements
                                    "
                                    [href]="'//' + file"
                                    target="_blank"
                                  >
                                    <i
                                      [class]="getFileIcon(file.split('.').pop())"
                                      class="file-icon me-2"
                                    ></i
                                  ></a>
                                </div>
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </div>
                  </div>
                <div *ngIf="leadDocuments?.currentAccountStatements == null">
                  <div class="text-center">
                    <div colspan="10" class="text-center fw-bold">
                      <!-- <img
                        alt="No Data"
                        src="../../../../assets/images/menu/no-data.gif"
                        width="200"
                        height="200"
                      /> -->
                      <p>No Current Account Data Found</p>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>

            <div  class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#supportingCollapse" aria-expanded="true" aria-controls="supportingCollapse">
                  OD Account Details
                </button>
              </h2>
              <div id="supportingCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                   <div>
                      <div class="detail-card">
                        <!-- <div *ngIf="leadDocuments?.odAccountStatements?.length > 0">
                      <div
                        *ngFor="
                          let account of leadDocuments?.odAccountStatements;
                          let i = index
                        "
                        class="business-details mt-3"
                      >
                        <div class="label" style="text-decoration: underline">
                          OD Account-{{ i + 1 }}
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Bank Name<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            {{ account.name | capitalizeFirst }}
                          </div>
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement From<b>:&nbsp;</b>
                          </div>
                          <div *ngIf="isValidDate(account.from)" class="value">
                            {{ account.from | date }}
                          </div>
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement To<b>:&nbsp;</b>
                          </div>
                          <div *ngIf="isValidDate(account.to)" class="value">
                            {{ account.to | date }}
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement Attachement<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            <div
                              *ngIf="
                                account?.odAccountStatements &&
                                account?.odAccountStatements.length > 0
                              "
                            >
                              <span
                                *ngFor="let file of account?.odAccountStatements"
                                class="me-2"
                              >
                                <a [href]="'//' + file" target="_blank"> View </a>
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            OD Limit<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            {{ account.odlimit }}
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            OD Sanction Letter<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            <div
                              *ngIf="
                                account?.odSactionLetter &&
                                account?.odSactionLetter.length > 0
                              "
                            >
                              <span
                                *ngFor="let file of account?.odSactionLetter"
                                class="me-2"
                              >
                                <a [href]="'//' + file" target="_blank"> View </a>
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div> -->
                        <!-- <div *ngIf="leadDocuments?.odAccountStatements?.length > 0">
                        <div
                          *ngFor="
                            let account of leadDocuments.odAccountStatements;
                            let i = index
                          "
                          class="business-details mt-3"
                        >
                          <div class="label" style="text-decoration: underline">
                            OD Account - {{ i + 1 }}
                          </div>

                          <div
                            class="info-line"
                            *ngFor="let field of odAccountFields"
                          >
                            <div class="label d-flex justify-content-between">
                              {{ field.label }} <b>:&nbsp;</b>
                            </div>
                            <div class="value">
                              <ng-container *ngIf="field.isDate">
                                <ng-container
                                  *ngIf="
                                    isValidDate(account[field.key]);
                                    else noValue
                                  "
                                >
                                  {{ account[field.key] | date }}
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.isFile">
                                <ng-container
                                  *ngIf="account[field.key]?.length > 0; else noValue"
                                >
                                  <span
                                    *ngFor="let file of account[field.key]"
                                    class="me-2"
                                  >
                                    <a [href]="'//' + file" target="_blank">View</a>
                                  </span>
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.pipe === 'capitalize'">
                                {{
                                  account[field.key]
                                    ? (account[field.key] | capitalizeFirst)
                                    : "-"
                                }}
                              </ng-container>

                              <ng-container
                                *ngIf="!field.isDate && !field.isFile && !field.pipe"
                              >
                                {{ account[field.key] || "-" }}
                              </ng-container>
                            </div>
                          </div>

                          <ng-template #noValue>-</ng-template>
                        </div>
                      </div> -->
                        <div
                          class="mt-2"
                          *ngIf="leadDocuments?.currentAccountStatements?.length > 0"
                        >
                          <p-table
                            [value]="leadDocuments?.odAccountStatements"
                            responsiveLayout="scroll"
                            class="custom-dark-table"
                          >
                            <!-- Header Template -->
                            <ng-template pTemplate="header">
                              <tr>
                                <th>Bank Name</th>
                                <th>From Date</th>
                                <th>To Date</th>
                                <th>Files</th>
                                <th>OD Limit</th>
                                <th>Sanction Letter</th>
                              </tr>
                            </ng-template>

                            <!-- Body Template -->
                            <ng-template let-stmt pTemplate="body">
                              <tr>
                                <td>{{ stmt.name || "-" }}</td>
                                <td>
                                  {{
                                    isValidDate(stmt.from)
                                      ? (stmt.from | date : "MMM dd, yyyy")
                                      : "-"
                                  }}
                                </td>
                                <td>
                                  {{
                                    isValidDate(stmt.to)
                                      ? (stmt.to | date : "MMM dd, yyyy")
                                      : "-"
                                  }}
                                </td>
                                <td>
                                  <div class="p-d-flex p-flex-wrap p-gap-2">
                                    <a
                                      *ngFor="let file of stmt.odAccountStatements"
                                      [href]="'//' + file"
                                      target="_blank"
                                    >
                                      <i
                                        [class]="getFileIcon(file.split('.').pop())"
                                        class="file-icon me-2"
                                      ></i>
                                    </a>
                                  </div>
                                </td>
                                <td>{{ stmt.odlimit || "-" }}</td>
                                <td>
                                  <a
                                    *ngFor="let file of stmt.odSactionLetter"
                                    [href]="'//' + file"
                                    target="_blank"
                                  >
                                    <i
                                      [class]="getFileIcon(file.split('.').pop())"
                                      class="file-icon me-2"
                                    ></i>
                                  </a>
                                </td>
                              </tr>
                            </ng-template>
                          </p-table>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="leadDocuments?.odAccountStatements == null">
                      <div class="text-center">
                        <div colspan="10" class="text-center fw-bold">
                          <!-- <img
                            alt="No Data"
                            src="../../../../assets/images/menu/no-data.gif"
                            width="200"
                            height="200"
                          /> -->
                          <p>No OD Account Data Found</p>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#kycCollapse" aria-expanded="true" aria-controls="kycCollapse">
                  Calculation for BTO Program
                </button>
              </h2>
              <div id="kycCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="row">
              <div class="col-md-4 mt-2">
                <div class="input-container">
                  <div class="my-1">
                    <label>Banking Turnover:&nbsp;</label>
                  </div>
                  <input
                    pInputText
                    class="rounded-lg"
                    type="number"
                    [(ngModel)]="bankingTurnover"
                    class="custom-input"
                    placeholder="Enter Banking Turn over "
                    autocomplete="off"
                  />
                </div>
              </div>
              <div class="col-md-4 mt-2">
                <div class="input-container">
                  <div class="my-1">
                    <label>Margin Interest (%):&nbsp;</label>
                  </div>
                  <input
                    pInputText
                    class="rounded-lg"
                    type="number"
                    [(ngModel)]="btoMargin"
                    class="custom-input"
                    placeholder="Enter Margin"
                    autocomplete="off"
                  />
                </div>
              </div>
              <div class="col-md-4 mt-2">
                <div class="input-container">
                  <div class="my-1">
                    <label>FOIR (%):&nbsp;</label>
                  </div>
                  <input
                    pInputText
                    class="rounded-lg"
                    type="number"
                    [(ngModel)]="btoMonths"
                    class="custom-input"
                    placeholder="Enter FOIR"
                    autocomplete="off"
                  />
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-center mt-3">
              <div class="me-3">
                <button
                  pButton
                  pRipple
                  type="button"
                  class="p-button-primary"
                  (click)="calculateBTOProgram()"
                >
                  Calculate
                </button>
              </div>
            </div>
            <div
              class="mt-3 fw-bold d-flex justify-content-center mt-3"
              *ngIf="btoValue"
            >
              <h6>
                Eligible Emi in BTO Program:<span
                  style="color: rgba(2, 5, 161, 0.91); font-weight: bold"
                >
                  {{ btoValue }}</span
                >
              </h6>
            </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!---GST Program-->
        <div *ngIf="selectedSection === 5">
          <!-- <h5 class="text-primary">GST Program</h5> -->
          <div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#kycCollapse" aria-expanded="true" aria-controls="kycCollapse">
                  GST Details
                </button>
              </h2>
              <div id="kycCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="">
                <div class="detail-card">
                  <div class="info-line mt-2">
                    <div class="label d-flex justify-content-between">
                      Total GSTR-3B Sale<b>:&nbsp;</b>
                    </div>
                    <div class="value fw-bold text-primary">
                      {{ totalGst3BSale }}
                    </div>
                  </div>

                  <!-- <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                <div
                  *ngFor="
                    let account of leadDocuments?.gstDetails;
                    let i = index
                  "
                  class="business-details mt-3"
                >
                  <div class="label" style="text-decoration: underline">
                    Operating State-{{ i + 1 }}
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      State<b>:&nbsp;</b>
                    </div>
                    <div class="value">
                      {{ account.operatingState | capitalizeFirst }}
                    </div>
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      Filing Period<b>:&nbsp;</b>
                    </div>
                    <div
                      *ngIf="isValidDate(account.filingPeriod)"
                      class="value"
                    >
                      {{ account.filingPeriod | date }}
                    </div>
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      GSTR-3B Sale<b>:&nbsp;</b>
                    </div>
                    <div class="value">{{ account.gst3BSale }}</div>
                  </div>
                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      GSTR-3B Attachment<b>:&nbsp;</b>
                    </div>
                    <div class="value">
                      <div
                        *ngIf="
                          account?.gstDetails && account?.gstDetails.length > 0
                        "
                      >
                        <span
                          *ngFor="let file of account?.gstDetails"
                          class="me-2"
                        >
                          <a [href]="'//' + file" target="_blank"> View </a>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
                  <!-- <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                  <div
                    *ngFor="
                      let account of leadDocuments.gstDetails;
                      let i = index
                    "
                    class="business-details mt-3"
                  >
                    <div class="label" style="text-decoration: underline">
                      Operating State - {{ i + 1 }}
                    </div>

                    <div
                      class="info-line"
                      *ngFor="let field of gstAccountFields"
                    >
                      <div class="label d-flex justify-content-between">
                        {{ field.label }} <b>:&nbsp;</b>
                      </div>
                      <div class="value">
                        <ng-container *ngIf="field.key === 'filingPeriod'">
                          <ng-container
                            *ngIf="
                              isValidDate(account[field.key]);
                              else noValue
                            "
                          >
                            {{ account[field.key] | date }}
                          </ng-container>
                        </ng-container>

                        <ng-container *ngIf="field.key === 'gstDetails'">
                          <ng-container
                            *ngIf="
                              account?.gstDetails?.length > 0;
                              else noValue
                            "
                          >
                            <span
                              *ngFor="let file of account.gstDetails"
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank">View</a>
                            </span>
                          </ng-container>
                        </ng-container>

                        <ng-container
                          *ngIf="
                            field.key !== 'filingPeriod' &&
                            field.key !== 'gstDetails'
                          "
                        >
                          {{ account[field.key] || "-" }}
                        </ng-container>
                      </div>
                    </div>

                    <ng-template #noValue>-</ng-template>
                  </div>
                </div> -->
                  <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                    <p-table
                      [value]="leadDocuments?.gstDetails"
                      responsiveLayout="scroll"
                      class="custom-dark-table"
                    >
                      <!-- Header Template -->
                      <ng-template pTemplate="header">
                        <tr>
                          <th>Operating State</th>
                          <th>Filing Period</th>
                          <th>GSTR 3B Sale</th>
                          <th>Attachments</th>
                        </tr>
                      </ng-template>

                      <!-- Body Template -->
                      <ng-template let-gst pTemplate="body">
                        <tr>
                          <td>{{ gst.operatingState }}</td>
                          <td>
                            {{
                              isValidDate(gst.filingPeriod)
                                ? (gst.filingPeriod | date : "MMM dd, yyyy")
                                : "-"
                            }}
                          </td>
                          <td>
                            {{ gst?.gst3BSale ? "" + gst.gst3BSale : "" }}
                          </td>
                          <td>
                            <div class="d-flex flex-wrap gap-2">
                              <a
                                *ngFor="let file of gst.gstDetails"
                                [href]="'//' + file"
                                target="_blank"
                              >
                                <i
                                  [class]="getFileIcon(file.split('.').pop())"
                                  class="file-icon me-2"
                                ></i>
                              </a>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
              <div *ngIf="leadDocuments?.gstDetails == null">
                <div class="text-center">
                  <div colspan="10" class="text-center fw-bold">
                    <!-- <img
                      alt="No Data"
                      src="../../../../assets/images/menu/no-data.gif"
                      width="200"
                      height="200"
                    /> -->
                    <p>No GST Details Found</p>
                  </div>
                </div>
              </div>
                </div>
              </div>
            </div>
            <div  class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#supportingCollapse" aria-expanded="true" aria-controls="supportingCollapse">
                  Calculation for GST Program
                </button>
              </h2>
              <div id="supportingCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>GST Turnover:&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="gstTurnover"
                            class="custom-input"
                            placeholder="Enter GST Turnover"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Margin Interest (%):&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="margin"
                            class="custom-input"
                            placeholder="Enter Margin"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>FOIR (%):&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="months"
                            class="custom-input"
                            placeholder="Enter FOIR"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center mt-3">
                      <div class="me-3">
                        <button
                          pButton
                          pRipple
                          type="button"
                          class="p-button-primary"
                          (click)="calculateGstProgram()"
                        >
                          Calculate
                        </button>
                      </div>
                    </div>
                    <div
                      class="mt-3 fw-bold d-flex justify-content-center mt-3"
                      *ngIf="gstValue"
                    >
                      <h6>
                        Eligible Emi in GST Program:<span
                          style="color: rgba(2, 5, 161, 0.91); font-weight: bold"
                        >
                          {{ gstValue }}</span
                        >
                      </h6>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Credit Summary -->
        <div *ngIf="selectedSection === 6">
          <label>Credit Summary</label>
          <textarea
            pInputTextarea
            class="form-control"
            placeholder="Enter Credit Summary"
            [(ngModel)]="creditSummary"
            (blur)="onCreditSummaryChange()"
          ></textarea>
        </div>

      </div>
      <!-- Buttons (bottom right) -->
        <div class="text-center mt-3">
          <!-- <button class="btn btn-primary me-2">Ready to Login</button>
          <button class="btn btn-outline-primary">Inhouse Reject</button> -->
          <div class="d-flex justify-content-center mt-3" *ngIf="leadData">
      <div class="me-3" *ngIf="leadData[0].leadInternalStatus == 5">
        <button
          pButton
          pRipple
          type="button"
          class="btn btn-primary me-2"
          (click)="sendLeadToReadyToLogin(leadData)"
        >
          Ready to Login
        </button>
      </div>
      <div *ngIf="leadData[0].leadInternalStatus == 5">
        <button
          pButton
          pRipple
          type="button"
          class="btn btn-outline-primary"
          (click)="sendLeadToReject(leadData)"
        >
          In House Reject
        </button>
      </div>
    </div>
        </div>
    </div>
  </div>
</div>
