<div class="main-section">
  <!-- Breadcrumb -->
  <div class="bread-crumb mb-3">
    <p-breadcrumb [model]="breadCrumbItems"></p-breadcrumb>
  </div>

  <!-- Back Button and Title -->
  <!-- <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center pointer-cursor" (click)="goBack()">
      <img
        src="../../../assets/images/icons/Vector.png"
        class="me-2"
        alt="Back"
      />
      <span class="back-btn-text text-capitalize">
        {{
          leadData[0]?.businessName || "Credit Assessment" || "N/A"
            | capitalizeFirst
        }}
      </span>
    </div>
  </div> -->
  <ng-container *ngFor="let item of displayedItems">
    <div class="m-2 p-1" *ngIf="item.data">
      <div class="d-flex justify-content-between">
        <div
          class="d-flex align-items-center justify-content-center pointer-cursor"
          (click)="goBack()"
        >
          <span class="me-2 d-flex align-items-center">
            <img src="../../../assets/images/icons/Vector.png" alt="Back" />
          </span>

          <b>
            <span class="back-btn-text text-capitalize">
              {{ item.data[item.displayProperty] || "N/A" | capitalizeFirst }}
            </span>
          </b>
        </div>
      </div>
    </div>
  </ng-container>
  <!-- Loader -->
  <div *ngIf="loading">
    <app-preloader></app-preloader>
  </div>

  <!-- Main Content -->
  <div class="row main-container text-capitalize" *ngIf="!loading">
    <!-- Stepper Sidebar -->
    <div class="col-md-3">
      <div class="stepper-box">
        <div
          *ngFor="let section of steps; let i = index"
          (click)="setSection(i)"
          class="stepper-item"
          [ngClass]="{ active: selectedSection === i }"
        >
          {{ section.label }}
        </div>
      </div>
    </div>

    <!-- Right Panel Content -->
    <div class="col-md-9" *ngIf="leadData">
      <div>
        <!-- Section: Business Information -->
        <div *ngIf="selectedSection === 0" class="card card-section">
          <div class="row">
            <div class="col-md-3 g-3" *ngFor="let field of businessFields">
              <div class="field-box">
                <label>{{ field.label }}</label>
                <div class="field-value">
                  <ng-container *ngIf="leadData[0]?.[field.key]; else noValue">
                    <span *ngIf="field.pipe === 'capitalize'">
                      {{ leadData[0][field.key] | capitalizeFirst }}
                    </span>
                    <span *ngIf="field.pipe === 'date'">
                      {{ leadData[0][field.key] | date }}
                    </span>
                    <span *ngIf="!field.pipe">
                      {{ leadData[0][field.key] }}
                    </span>
                  </ng-container>
                  <ng-template #noValue>-</ng-template>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Uploaded Documents -->
        <div *ngIf="selectedSection === 1" class="card card-section">
          <div class="row">
            <!-- Proprietorship -->
            <div
              *ngIf="
                leadData[0]?.businessEntity === 'proprietorship' &&
                leadDocuments
              "
              class="detail-card"
            >
              <div class="business-details">
                <div
                  class="col-md-3 info-line"
                  *ngFor="let doc of documentTypes"
                >
                  <div class="label d-flex justify-content-between">
                    {{ doc.label }}
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.[doc.key]?.length > 0; else noData"
                    >
                      <span
                        *ngFor="let file of leadDocuments[doc.key]"
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                    <ng-template #noData>-</ng-template>
                  </div>
                </div>
              </div>
            </div>

            <!-- Partnership -->
            <div
              *ngIf="
                leadData[0]?.businessEntity === 'partnership' && leadDocuments
              "
              class="detail-card"
            >
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    Firm PAN
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPan; else noValue"
                    >
                      {{ leadDocuments.firmPanCard[0].firmPan }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    PAN Card
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPanCard?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="
                          let file of leadDocuments.firmPanCard[0].firmPanCard
                        "
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div
                  class="info-line"
                  *ngFor="let doc of remainingFirmDocuments"
                >
                  <div class="label d-flex justify-content-between">
                    {{ doc.label }}
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="let file of leadDocuments[doc.key]"
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>

            <!-- LLP -->
            <div
              *ngIf="leadData[0]?.businessEntity === 'llp' && leadDocuments"
              class="detail-card"
            >
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    Firm PAN Number
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPan; else noValue"
                    >
                      {{ leadDocuments.firmPanCard[0].firmPan }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    Firm PAN Card
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.firmPanCard?.[0]?.firmPanCard?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="
                          let file of leadDocuments.firmPanCard[0].firmPanCard
                        "
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div class="info-line" *ngFor="let doc of llpFirmDocuments">
                  <div class="label d-flex justify-content-between">
                    {{ doc.label }}
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="let file of leadDocuments[doc.key]"
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>

            <!-- Private Limited -->
            <div
              *ngIf="
                leadData[0]?.businessEntity === 'privateLimited' &&
                leadDocuments
              "
              class="detail-card"
            >
              <div class="business-details">
                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    Company PAN Number
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.companyPan?.[0]?.panNumber; else noValue"
                    >
                      {{ leadDocuments.companyPan[0].panNumber }}
                    </ng-container>
                  </div>
                </div>

                <div class="info-line">
                  <div class="label d-flex justify-content-between">
                    Company PAN Card
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.companyPan?.[0]?.companyPan?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="
                          let file of leadDocuments.companyPan[0].companyPan
                        "
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>

                <div class="info-line" *ngFor="let doc of companyDocuments">
                  <div class="label d-flex justify-content-between">
                    {{ doc.label }}
                  </div>
                  <div class="value">
                    <ng-container
                      *ngIf="leadDocuments?.[doc.key]?.length > 0; else noValue"
                    >
                      <span
                        *ngFor="let file of leadDocuments[doc.key]"
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <ng-template #noValue>-</ng-template>
              </div>
            </div>

            <div
              *ngIf="
                leadData?.length &&
                leadData[0].loanType === 'carLoan' &&
                leadData[0].carType === 1
              "
            >
              <div class="label fw-bold mb-1">
                <span
                  style="color: #101828; font-weight: 500; margin-left: 30px"
                  >RC Copy</span
                >
              </div>
              <div class="value">
                <div
                  *ngIf="
                    leadData &&
                    leadData[0]?.rcCopy &&
                    leadData[0]?.rcCopy?.length > 0
                  "
                >
                  <span *ngFor="let file of leadData[0]?.rcCopy" class="me-2">
                    <a [href]="'//' + file" target="_blank">View</a>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="row mb-3"
              *ngIf="
                leadData?.length &&
                leadData[0].loanType === 'carLoan' &&
                leadData[0].carType === 2
              "
            >
              <!--New Car quotation -->
              <div class="col-md-6 col-12">
                <div
                  class="info-line"
                  *ngIf="leadData[0]?.newCarQuotation"
                  style="margin-bottom: 1rem"
                >
                  <div
                    class="label fw-bold mb-1"
                    style="
                      font-weight: 500;
                      white-space: nowrap;
                      color: #101828;
                    "
                  >
                    <span style="color: #101828; font-weight: 500"
                      >New Car quotation
                    </span>
                  </div>
                  <div class="value" style="margin-top: 2px">
                    {{ leadData[0]?.newCarQuotation | capitalizeFirst }}
                  </div>
                </div>
              </div>

              <!---New Car Quotation-->
              <div class="col-md-6 col-12">
                <div class="info-line">
                  <div class="label fw-bold mb-1">
                    <span
                      style="
                        color: #101828;
                        font-weight: 500;
                        margin-left: 30px;
                      "
                      >New Car Quotation File</span
                    >
                  </div>
                  <div class="value">
                    <div
                      *ngIf="
                        leadData &&
                        leadData[0]?.newCarQuotationFile &&
                        leadData[0]?.newCarQuotationFile?.length > 0
                      "
                    >
                      <span
                        *ngFor="let file of leadData[0]?.newCarQuotationFile"
                        class="me-2"
                      >
                        <a [href]="'//' + file" target="_blank">View</a>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Existing Loans -->
        <div *ngIf="selectedSection === 2" class="card card-section">
          <img
            *ngIf="userDetails?.userType != 3"
            src="assets/images/icons/edit.svg"
            alt="Edit"
            width="18"
            height="18"
            pTooltip="Update"
            tooltipPosition="top"
            (click)="uploadLeadFiles(leadData[0])"
            class="position-absolute me-2 edit-icon"
            style="top: 1rem; right: 1rem; cursor: pointer"
          />

          <div *ngIf="leadDocuments?.existingLoans?.length > 0">
            <div
              *ngFor="let loan of leadDocuments.existingLoans; let i = index"
              class="business-details"
            >
              <input
                class="label"
                type="checkbox"
                [value]="loan.emiAmount"
                (change)="calculateTotalEmi()"
              />
              <span class="label">Existing Loan - {{ i + 1 }}</span>

              <!-- Dynamic fields -->
              <div class="info-line" *ngFor="let field of existingLoanFields">
                <div class="label d-flex justify-content-between">
                  {{ field.label }}
                </div>
                <div class="value">
                  <!-- Capitalize pipe -->
                  <ng-container *ngIf="field.pipe === 'capitalize'">
                    {{
                      loan[field.key]
                        ? (loan[field.key] | capitalizeFirst)
                        : "-"
                    }}
                  </ng-container>

                  <!-- Date pipe with validity check -->
                  <ng-container *ngIf="field.pipe === 'date'">
                    <ng-container
                      *ngIf="isValidDate(loan[field.key]); else noValue"
                    >
                      {{ loan[field.key] | date }}
                    </ng-container>
                  </ng-container>

                  <!-- Regular field with fallback -->
                  <ng-container *ngIf="!field.pipe">
                    {{ loan[field.key] || "-" }}
                  </ng-container>

                  <ng-template #noValue>-</ng-template>
                </div>
              </div>

              <!-- Fallback dash -->
              <ng-template #noValue>-</ng-template>
            </div>

            <!-- Total EMI Display -->
            <div class="p-3 mt-3 fw-bold" style="border-radius: 3px">
              <div>Total Monthly EMI Payment: {{ totalEmi }}</div>
            </div>
          </div>

          <div *ngIf="!leadDocuments?.existingLoans?.length">
            <p class="text-muted">No existing loan data available.</p>
          </div>
        </div>

        <!-- Section: DSCR Tabs -->
        <div *ngIf="selectedSection === 3" class="card card-section">
          <img
            *ngIf="userDetails?.userType != 3"
            src="assets/images/icons/edit.svg"
            alt="Edit"
            width="18"
            height="18"
            pTooltip="Update"
            tooltipPosition="top"
            (click)="uploadLeadFiles(leadData[0])"
            class="position-absolute me-2 edit-icon"
            style="top: 1rem; right: 1rem; cursor: pointer"
          />

          <!-- <h5 class="text-primary fw-bold mb-3">DSCR Ratio</h5> -->
          <div>
            <!-- DSCR Accordion -->
            <div class="accordion-item">
              <div
                class="accordion-header d-flex justify-content-between align-items-center"
              >
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#dscrCollapse"
                  aria-expanded="true"
                  aria-controls="dscrCollapse"
                >
                  DSCR Calculation
                </button>

                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#dscrCollapse"
                  aria-expanded="false"
                  aria-controls="dscrCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#dscrCollapse"
                  aria-expanded="false"
                  aria-controls="dscrCollapse"
                />
              </div>
              <div id="dscrCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body card-bodysection">
                  <div class="row" *ngIf="leadDocuments?.financialReturns">
                    <!-- Past ITR -->
                    <div class="col-md-6">
                      <div class="info-line mb-2">
                        <div class="label d-flex justify-content-between">
                          Assessment Year
                        </div>
                        <div class="value">
                          {{
                            leadDocuments?.financialReturns[0]?.pastIncomeTax
                          }}
                        </div>
                      </div>
                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Attachment
                        </div>
                        <div class="value">
                          <ng-container
                            *ngIf="
                              leadDocuments?.financialReturns[0]
                                ?.pastIncomeReturns?.length > 0
                            "
                          >
                            <span
                              *ngFor="
                                let file of leadDocuments?.financialReturns[0]
                                  ?.pastIncomeReturns
                              "
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank">View</a>
                            </span>
                          </ng-container>
                        </div>
                      </div>
                    </div>

                    <!-- Present ITR -->
                    <div class="col-md-6 g-3">
                      <div class="info-line mb-2">
                        <div class="label d-flex justify-content-between">
                          Assessment Year
                        </div>
                        <div class="value">
                          {{
                            leadDocuments?.financialReturns[0]?.presentIncomeTax
                          }}
                        </div>
                      </div>
                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Attachment
                        </div>
                        <div class="value">
                          <ng-container
                            *ngIf="
                              leadDocuments?.financialReturns[0]
                                ?.presentIncomeReturns?.length > 0
                            "
                          >
                            <span
                              *ngFor="
                                let file of leadDocuments?.financialReturns[0]
                                  ?.presentIncomeReturns
                              "
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank">View</a>
                            </span>
                          </ng-container>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="leadDocuments?.financialReturns == null">
                    <p>ITR Documents Not Uploaded</p>
                  </div>
                  <div
                    class="label fw-bold mb-4"
                    style="text-decoration: underline"
                  >
                    Profit and Loss Statement
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck1"
                      [(ngModel)]="isFirstYearSelected"
                    />
                    <label class="form-check-label" for="defaultCheck1">
                      {{ getFinancialYear() }}
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck2"
                      [(ngModel)]="isSecondYearSelected"
                    />
                    <label class="form-check-label" for="defaultCheck2">
                      {{ getFinancialYear(1) }}
                    </label>
                  </div>
                  <div *ngIf="isFirstYearSelected">
                    <div
                      class="label fw-bold mt-3"
                      style="text-decoration: underline"
                    >
                      {{ getFinancialYear() }}
                    </div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Turnover / Sales :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="turnoverAy1"
                            class="custom-input"
                            placeholder="Enter Turnover / Sales"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Purchases&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="purchasesAy1"
                            class="custom-input"
                            placeholder="Enter Purchases"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Profit After Tax&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="profitaftertaxAy1"
                            class="custom-input"
                            placeholder="Enter Profit After Tax"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Depreciation&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="depreciationAy1"
                            class="custom-input"
                            placeholder="Enter Depreciation"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Interest on Loans&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="interestonLoansAy1"
                            class="custom-input"
                            placeholder="Enter Interest on Loans"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Enter No of Months&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="monthsAy1"
                            class="custom-input"
                            placeholder="Enter no of Months"
                            autocomplete="off"
                          />
                        </div>
                      </div>

                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'partnership'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Partners Remuneration &nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="partnerRemuAy1"
                            class="custom-input"
                            placeholder="Enter Partner Remuneration"
                            autocomplete="off"
                          />
                        </div>
                      </div>

                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'partnership'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Interest On Partners Capital :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="partnerInterestAy1"
                            class="custom-input"
                            placeholder="Enter Enter Interest on Partners Capital"
                            autocomplete="off"
                          />
                        </div>
                      </div>

                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'privateLimited'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Directors Remuneration :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="directorsRemuAy1"
                            class="custom-input"
                            placeholder="Enter Directors Remuneration"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="isSecondYearSelected">
                    <div
                      class="label fw-bold mt-3"
                      style="text-decoration: underline"
                    >
                      {{ getFinancialYear(1) }}
                    </div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Turnover / Sales&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="turnoverAy2"
                            class="custom-input"
                            placeholder="Enter Turnover / Sales"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Purchases&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="purchasesAy2"
                            class="custom-input"
                            placeholder="Enter Depreciation"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Profit After Tax&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="profitaftertaxAy2"
                            class="custom-input"
                            placeholder="Enter Profit After Tax"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Depreciation&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="depreciationAy2"
                            class="custom-input"
                            placeholder="Enter Depreciation"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Interest On Loans&nbsp;:</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="interestonLoansAy2"
                            class="custom-input"
                            placeholder="Enter Interest on Loans"
                            autocomplete="off"
                          />
                        </div>
                      </div>

                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'partnership'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Partners Remuneration :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="partnerRemuAy2"
                            class="custom-input"
                            placeholder="Enter Partner Remuneration"
                            autocomplete="off"
                          />
                        </div>
                      </div>

                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'partnership'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Interest On Partners Capital :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="partnerInterestAy2"
                            class="custom-input"
                            placeholder="Enter Interest on Partners Capital"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div
                        class="col-md-4 mt-2"
                        *ngIf="leadData[0]?.businessEntity == 'privateLimited'"
                      >
                        <div class="input-container">
                          <div class="my-1">
                            <label>Directors Remuneration :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="directorsRemuAy2"
                            class="custom-input"
                            placeholder="Enter Directors Remuneration"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr />
                  <div class="row">
                    <div class="col-md-4">
                      <div class="input-container">
                        <div class="my-1">
                          <label>Total EMI&nbsp;:</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="totalEmi"
                          class="custom-input"
                          placeholder="Enter Total Emi"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="input-container">
                        <div class="my-1">
                          <label>Proposed EMI&nbsp;:</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="proposedEmi"
                          class="custom-input"
                          placeholder="Enter Proposed Emi"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="input-container">
                        <div class="my-1">
                          <label>OD/CC Interest&nbsp;:</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="odCcInterestAy1"
                          class="custom-input"
                          placeholder="Enter OD/CC Interest"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-center mt-3">
                    <button
                      pButton
                      pRipple
                      type="button"
                      class="p-button-info"
                      (click)="calculateChanges()"
                    >
                      Check Turnover & Profit Change
                    </button>
                  </div>
                  <div
                    class="mt-3 fw-bold d-flex justify-content-center"
                    *ngIf="turnoverChangeMessage"
                  >
                    <h6
                      [ngStyle]="{
                        color: turnoverChangeMessage.includes('Rise')
                          ? 'green'
                          : turnoverChangeMessage.includes('Dip')
                          ? 'red'
                          : 'black'
                      }"
                    >
                      Turnover: {{ turnoverChangeMessage }}
                    </h6>
                  </div>

                  <!-- Profit Result -->
                  <div
                    class="mt-3 fw-bold d-flex justify-content-center"
                    *ngIf="profitChangeMessage"
                  >
                    <h6
                      [ngStyle]="{
                        color: profitChangeMessage.includes('Rise')
                          ? 'green'
                          : profitChangeMessage.includes('Dip')
                          ? 'red'
                          : 'black'
                      }"
                    >
                      Profit After Tax: {{ profitChangeMessage }}
                    </h6>
                  </div>
                  <div class="d-flex justify-content-center mt-3">
                    <div class="me-3">
                      <button
                        pButton
                        pRipple
                        type="button"
                        class="p-button-primary"
                        (click)="calculateDscrRatio()"
                      >
                        Calculate
                      </button>
                    </div>
                  </div>
                  <div class="mt-3 fw-bold d-flex justify-content-center mt-3">
                    <h6>
                      Result for {{ getFinancialYear() }} :<span
                        style="color: #8e89d0; font-weight: bold"
                      >
                        {{ resultFirstYear }}</span
                      >
                    </h6>
                  </div>
                </div>
              </div>
            </div>

            <!-- Balance Sheet Accordion -->
            <div class="accordion-item">
              <div
                class="accordion-header d-flex justify-content-between align-items-center"
              >
                <button
                  class="accordion-button"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#balanceCollapse"
                  aria-expanded="true"
                  aria-controls="balanceCollapse"
                >
                  Balance Sheet
                </button>
                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#balanceCollapse"
                  aria-expanded="false"
                  aria-controls="balanceCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#balanceCollapse"
                  aria-expanded="false"
                  aria-controls="balanceCollapse"
                />
              </div>
              <div
                id="balanceCollapse"
                class="accordion-collapse collapse show"
              >
                <div class="accordion-body card-bodysection">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck1"
                      [(ngModel)]="isFirstYearBalanceSheet"
                    />
                    <label class="form-check-label" for="defaultCheck1">
                      {{ getFinancialYear() }}
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="defaultCheck2"
                      [(ngModel)]="isSecondYearBalanceSheet"
                    />
                    <label class="form-check-label" for="defaultCheck2">
                      {{ getFinancialYear(1) }}
                    </label>
                  </div>
                  <div *ngIf="isFirstYearBalanceSheet">
                    <div
                      class="label fw-bold mt-3"
                      style="text-decoration: underline"
                    >
                      {{ getFinancialYear() }}
                    </div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Sundry Debtors :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="sundryDebtorsAy1"
                            class="custom-input"
                            placeholder="Enter Sundry Debtors"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Sundry Creditors :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="sundryCreditorsAy1"
                            class="custom-input"
                            placeholder="Enter Sundry Creditors"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="isSecondYearBalanceSheet">
                    <div
                      class="label fw-bold mt-3"
                      style="text-decoration: underline"
                    >
                      {{ getFinancialYear(1) }}
                    </div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Sundry Debtors :&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="sundryDebtorsAy2"
                            class="custom-input"
                            placeholder="Enter Sundry Debtors"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Sundry Creditors:&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="sundryCreditorsAy2"
                            class="custom-input"
                            placeholder="Enter Sundry Creditors"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex justify-content-center mt-3">
                    <div class="me-3">
                      <button
                        pButton
                        pRipple
                        type="button"
                        class="p-button-primary"
                        (click)="calculateBalanceSheet()"
                      >
                        Calculate
                      </button>
                    </div>
                  </div>
                  <div class="mt-3 fw-bold">
                    <h6 class="d-flex justify-content-center">
                      Debtor Days for {{ getFinancialYear() }} :<span
                        style="color: #8e89d0; font-weight: bold"
                      >
                        &nbsp; {{ debtor_daysFirstYear }}</span
                      >
                    </h6>
                    <h6 class="d-flex justify-content-center">
                      Creditor Days for {{ getFinancialYear() }} :<span
                        style="color: #8e89d0; font-weight: bold"
                      >
                        &nbsp;{{ creditor_daysFirstYear }}</span
                      >
                    </h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!---Section: BTO Program-->
        <div *ngIf="selectedSection === 4" class="card card-section">
          <img
            *ngIf="userDetails?.userType != 3"
            src="assets/images/icons/edit.svg"
            alt="Edit"
            width="18"
            height="18"
            pTooltip="Update"
            tooltipPosition="top"
            (click)="uploadLeadFiles(leadData[0])"
            class="position-absolute me-2 edit-icon"
            style="top: 1rem; right: 1rem; cursor: pointer"
          />

          <!-- <h5 class="text-primary">BTO Program</h5> -->
          <div>
            <div class="accordion-item">
              <div class="accordion-header d-flex justify-content-between align-items-center">
                <button
                  class="accordion-button fw-semibold collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#BTOCollapse"
                  aria-expanded="true"
                  aria-controls="BTOCollapse"
                >
                  BTO Calculation
                </button>

                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#BTOCollapse"
                  aria-expanded="false"
                  aria-controls="BTOCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#BTOCollapse"
                  aria-expanded="false"
                  aria-controls="BTOCollapse"
                />
              </div>
              <div id="BTOCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body card-bodysection">
                  <div>
                    <div class="detail-card">
                      <!-- <div *ngIf="leadDocuments?.currentAccountStatements?.length > 0">
                    <div
                      *ngFor="
                        let account of leadDocuments?.currentAccountStatements;
                        let i = index
                      "
                      class="business-details mt-3"
                    >
                      <div class="label" style="text-decoration: underline">
                        Current Account-{{ i + 1 }}
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Bank Name<b>:&nbsp;</b>
                        </div>
                        <div class="value">
                          {{ account.name | capitalizeFirst }}
                        </div>
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement From<b>:&nbsp;</b>
                        </div>
                        <div *ngIf="isValidDate(account.from)" class="value">
                          {{ account.from | date }}
                        </div>
                      </div>

                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement To<b>:&nbsp;</b>
                        </div>
                        <div *ngIf="isValidDate(account.to)" class="value">
                          {{ account.to | date }}
                        </div>
                      </div>
                      <div class="info-line">
                        <div class="label d-flex justify-content-between">
                          Statement Attachement<b>:&nbsp;</b>
                        </div>
                        <div class="value">
                          <div
                            *ngIf="
                              account?.currentAccountStatements &&
                              account?.currentAccountStatements.length > 0
                            "
                          >
                            <span
                              *ngFor="let file of account?.currentAccountStatements"
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank"> View </a>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> -->

                      <!-- <div class="scrollable-content">
                      <div
                        *ngIf="leadDocuments?.currentAccountStatements?.length > 0"
                      >
                        <div
                          *ngFor="
                            let account of leadDocuments.currentAccountStatements;
                            let i = index
                          "
                          class="business-details mt-3"
                        >
                          <div class="label" style="text-decoration: underline">
                            Current Account - {{ i + 1 }}
                          </div>
                          <div
                            class="info-line"
                            *ngFor="let field of currentAccountFields"
                          >
                            <div class="label d-flex justify-content-between">
                              {{ field.label }} <b>:&nbsp;</b>
                            </div>
                            <div class="value">
                              <ng-container *ngIf="field.isDate">
                                <ng-container
                                  *ngIf="
                                    isValidDate(account[field.key]);
                                    else noValue
                                  "
                                >
                                  {{ account[field.key] | date }}
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.pipe === 'capitalize'">
                                {{
                                  account[field.key]
                                    ? (account[field.key] | capitalizeFirst)
                                    : "-"
                                }}
                              </ng-container>

                              <ng-container
                                *ngIf="
                                  !field.isDate &&
                                  !field.pipe &&
                                  field.key !== 'currentAccountStatements'
                                "
                              >
                                {{ account[field.key] || "-" }}
                              </ng-container>

                              <ng-container
                                *ngIf="field.key === 'currentAccountStatements'"
                              >
                                <ng-container
                                  *ngIf="
                                    account?.currentAccountStatements?.length > 0;
                                    else noValue
                                  "
                                >
                                  <span
                                    *ngFor="
                                      let file of account.currentAccountStatements
                                    "
                                    class="me-2"
                                  >
                                    <a [href]="'//' + file" target="_blank">View</a>
                                  </span>
                                </ng-container>
                              </ng-container>
                            </div>
                          </div>

                          <ng-template #noValue>-</ng-template>
                        </div>
                      </div>
                    </div> -->

                      <div
                        *ngIf="
                          leadDocuments?.currentAccountStatements?.length > 0
                        "
                      >
                        <p-table
                          [value]="leadDocuments?.currentAccountStatements"
                          responsiveLayout="scroll"
                          class="custom-dark-table"
                        >
                          <!-- Header Template -->
                          <ng-template pTemplate="header">
                            <tr>
                              <th>Bank Name</th>
                              <th>From Date</th>
                              <th>To Date</th>
                              <th>Files</th>
                            </tr>
                          </ng-template>

                          <!-- Body Template -->
                          <ng-template let-stmt pTemplate="body">
                            <tr>
                              <td>{{ stmt.name }}</td>
                              <td>
                                {{
                                  isValidDate(stmt.from)
                                    ? (stmt.from | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                {{
                                  isValidDate(stmt.to)
                                    ? (stmt.to | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                <div class="p-d-flex p-flex-wrap p-gap-2">
                                  <a
                                    *ngFor="
                                      let file of stmt.currentAccountStatements
                                    "
                                    [href]="'//' + file"
                                    target="_blank"
                                  >
                                    <i
                                      [class]="
                                        getFileIcon(file.split('.').pop())
                                      "
                                      class="file-icon me-2"
                                    ></i
                                  ></a>
                                </div>
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="leadDocuments?.currentAccountStatements == null">
                    <div class="text-center">
                      <div colspan="10" class="text-center fw-bold">
                        <!-- <img
                        alt="No Data"
                        src="../../../../assets/images/menu/no-data.gif"
                        width="200"
                        height="200"
                      /> -->
                        <p
                          style="
                            color: #535ab4;
                            font-weight: 400;
                            font-size: 18px;
                          "
                        >
                          No Current Account Data Found
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-header d-flex justify-content-between align-items-center">
                <button
                  class="accordion-button fw-semibold collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#odAccountCollapse"
                  aria-expanded="true"
                  aria-controls="odAccountCollapse"
                >
                  OD Account Details
                </button>
                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#odAccountCollapse"
                  aria-expanded="false"
                  aria-controls="odAccountCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#odAccountCollapse"
                  aria-expanded="false"
                  aria-controls="odAccountCollapse"
                />
              </div>
              <div
                id="odAccountCollapse"
                class="accordion-collapse collapse show"
              >
                <div class="accordion-body card-bodysection">
                  <div>
                    <div class="detail-card">
                      <!-- <div *ngIf="leadDocuments?.odAccountStatements?.length > 0">
                      <div
                        *ngFor="
                          let account of leadDocuments?.odAccountStatements;
                          let i = index
                        "
                        class="business-details mt-3"
                      >
                        <div class="label" style="text-decoration: underline">
                          OD Account-{{ i + 1 }}
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Bank Name<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            {{ account.name | capitalizeFirst }}
                          </div>
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement From<b>:&nbsp;</b>
                          </div>
                          <div *ngIf="isValidDate(account.from)" class="value">
                            {{ account.from | date }}
                          </div>
                        </div>

                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement To<b>:&nbsp;</b>
                          </div>
                          <div *ngIf="isValidDate(account.to)" class="value">
                            {{ account.to | date }}
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            Statement Attachement<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            <div
                              *ngIf="
                                account?.odAccountStatements &&
                                account?.odAccountStatements.length > 0
                              "
                            >
                              <span
                                *ngFor="let file of account?.odAccountStatements"
                                class="me-2"
                              >
                                <a [href]="'//' + file" target="_blank"> View </a>
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            OD Limit<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            {{ account.odlimit }}
                          </div>
                        </div>
                        <div class="info-line">
                          <div class="label d-flex justify-content-between">
                            OD Sanction Letter<b>:&nbsp;</b>
                          </div>
                          <div class="value">
                            <div
                              *ngIf="
                                account?.odSactionLetter &&
                                account?.odSactionLetter.length > 0
                              "
                            >
                              <span
                                *ngFor="let file of account?.odSactionLetter"
                                class="me-2"
                              >
                                <a [href]="'//' + file" target="_blank"> View </a>
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div> -->
                      <!-- <div *ngIf="leadDocuments?.odAccountStatements?.length > 0">
                        <div
                          *ngFor="
                            let account of leadDocuments.odAccountStatements;
                            let i = index
                          "
                          class="business-details mt-3"
                        >
                          <div class="label" style="text-decoration: underline">
                            OD Account - {{ i + 1 }}
                          </div>

                          <div
                            class="info-line"
                            *ngFor="let field of odAccountFields"
                          >
                            <div class="label d-flex justify-content-between">
                              {{ field.label }} <b>:&nbsp;</b>
                            </div>
                            <div class="value">
                              <ng-container *ngIf="field.isDate">
                                <ng-container
                                  *ngIf="
                                    isValidDate(account[field.key]);
                                    else noValue
                                  "
                                >
                                  {{ account[field.key] | date }}
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.isFile">
                                <ng-container
                                  *ngIf="account[field.key]?.length > 0; else noValue"
                                >
                                  <span
                                    *ngFor="let file of account[field.key]"
                                    class="me-2"
                                  >
                                    <a [href]="'//' + file" target="_blank">View</a>
                                  </span>
                                </ng-container>
                              </ng-container>

                              <ng-container *ngIf="field.pipe === 'capitalize'">
                                {{
                                  account[field.key]
                                    ? (account[field.key] | capitalizeFirst)
                                    : "-"
                                }}
                              </ng-container>

                              <ng-container
                                *ngIf="!field.isDate && !field.isFile && !field.pipe"
                              >
                                {{ account[field.key] || "-" }}
                              </ng-container>
                            </div>
                          </div>

                          <ng-template #noValue>-</ng-template>
                        </div>
                      </div> -->
                      <div
                        class="mt-2"
                        *ngIf="
                          leadDocuments?.currentAccountStatements?.length > 0
                        "
                      >
                        <p-table
                          [value]="leadDocuments?.odAccountStatements"
                          responsiveLayout="scroll"
                          class="custom-dark-table"
                        >
                          <!-- Header Template -->
                          <ng-template pTemplate="header">
                            <tr>
                              <th>Bank Name</th>
                              <th>From Date</th>
                              <th>To Date</th>
                              <th>Files</th>
                              <th>OD Limit</th>
                              <th>Sanction Letter</th>
                            </tr>
                          </ng-template>

                          <!-- Body Template -->
                          <ng-template let-stmt pTemplate="body">
                            <tr>
                              <td>{{ stmt.name || "-" }}</td>
                              <td>
                                {{
                                  isValidDate(stmt.from)
                                    ? (stmt.from | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                {{
                                  isValidDate(stmt.to)
                                    ? (stmt.to | date : "MMM dd, yyyy")
                                    : "-"
                                }}
                              </td>
                              <td>
                                <div class="p-d-flex p-flex-wrap p-gap-2">
                                  <a
                                    *ngFor="
                                      let file of stmt.odAccountStatements
                                    "
                                    [href]="'//' + file"
                                    target="_blank"
                                  >
                                    <i
                                      [class]="
                                        getFileIcon(file.split('.').pop())
                                      "
                                      class="file-icon me-2"
                                    ></i>
                                  </a>
                                </div>
                              </td>
                              <td>{{ stmt.odlimit || "-" }}</td>
                              <td>
                                <a
                                  *ngFor="let file of stmt.odSactionLetter"
                                  [href]="'//' + file"
                                  target="_blank"
                                >
                                  <i
                                    [class]="getFileIcon(file.split('.').pop())"
                                    class="file-icon me-2"
                                  ></i>
                                </a>
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="leadDocuments?.odAccountStatements == null">
                    <div class="text-center">
                      <div colspan="10" class="text-center fw-bold">
                        <!-- <img
                            alt="No Data"
                            src="../../../../assets/images/menu/no-data.gif"
                            width="200"
                            height="200"
                          /> -->
                        <p
                          style="
                            color: #535ab4;
                            font-weight: 400;
                            font-size: 18px;
                          "
                        >
                          No OD Account Data Found
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="accordion-item">
              <div class="accordion-header d-flex justify-content-between align-items-center">
                <button
                  class="accordion-button fw-semibold collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#CalculateBTOCollapse"
                  aria-expanded="true"
                  aria-controls="kycCollapse"
                >
                  Calculation for BTO Program
                </button>
                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#CalculateBTOCollapse"
                  aria-expanded="false"
                  aria-controls="dscrCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#CalculateBTOCollapse"
                  aria-expanded="false"
                  aria-controls="dscrCollapse"
                />
              </div>
              <div id="CalculateBTOCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body card-bodysection">
                  <div class="row">
                    <div class="col-md-4 mt-2">
                      <div class="input-container">
                        <div class="my-1">
                          <label>Banking Turnover:&nbsp;</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="bankingTurnover"
                          class="custom-input"
                          placeholder="Enter Banking Turn over "
                          autocomplete="off"
                        />
                      </div>
                    </div>
                    <div class="col-md-4 mt-2">
                      <div class="input-container">
                        <div class="my-1">
                          <label>Margin Interest (%):&nbsp;</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="btoMargin"
                          class="custom-input"
                          placeholder="Enter Margin"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                    <div class="col-md-4 mt-2">
                      <div class="input-container">
                        <div class="my-1">
                          <label>FOIR (%):&nbsp;</label>
                        </div>
                        <input
                          pInputText
                          class="rounded-lg"
                          type="number"
                          [(ngModel)]="btoMonths"
                          class="custom-input"
                          placeholder="Enter FOIR"
                          autocomplete="off"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-center mt-3">
                    <div class="me-3">
                      <button
                        pButton
                        pRipple
                        type="button"
                        class="p-button-primary"
                        (click)="calculateBTOProgram()"
                      >
                        Calculate
                      </button>
                    </div>
                  </div>
                  <!-- <div
                    class="mt-3 fw-bold d-flex justify-content-center mt-3"
                    *ngIf="btoValue"
                  >
                    <h6>
                      Eligible Emi in BTO Program:<span
                        style="color: #8e89d0; font-weight: bold"
                      >
                        {{ btoValue }}</span
                      >
                    </h6>
                  </div> -->
                  <div
                    class="mt-3 fw-bold d-flex justify-content-center mt-3"
                    *ngIf="btoValue"
                  >
                    <div class="text-center">
                      <h5>
                        <b>Eligible EMI in BTO Program</b>:
                        <span style="color: #8e89d0; font-weight: bold">
                          {{ btoValue }}
                        </span>
                      </h5>

                      <!-- Personal Loan (or any loan other than Home Loan & LAP) -->
                      <ng-container
                        *ngIf="
                          leadData[0].loanType !== 'homeLoan' &&
                          leadData[0].loanType !== 'lap'
                        "
                      >
                        <h6>
                          Loan Amount:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btoloanAmount }}
                          </span>
                        </h6>
                        <h6>
                          Tenure:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btotenure }} months
                          </span>
                        </h6>
                        <h6>
                          Interest Rate:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btointerest }} %
                          </span>
                        </h6>
                      </ng-container>

                      <!-- Home Loan -->
                      <ng-container *ngIf="leadData[0].loanType === 'homeLoan'">
                        <h6>
                          Loan Amount:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btohomeloanAmount }}
                          </span>
                        </h6>
                        <h6>
                          Tenure:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btohomeloantenure }} months
                          </span>
                        </h6>
                        <h6>
                          Interest Rate:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btohomeloaninterest }} %
                          </span>
                        </h6>
                      </ng-container>

                      <!-- LAP Loan -->
                      <ng-container *ngIf="leadData[0].loanType === 'lap'">
                        <h6>
                          Loan Amount:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btolapAmount }}
                          </span>
                        </h6>
                        <h6>
                          Tenure:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btolapTenure }} months
                          </span>
                        </h6>
                        <h6>
                          Interest Rate:
                          <span style="color: #8e89d0; font-weight: bold">
                            {{ btolapInterest }} %
                          </span>
                        </h6>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!---GST Program-->
        <div *ngIf="selectedSection === 5" class="card card-section">
          <img
            *ngIf="userDetails?.userType != 3"
            src="assets/images/icons/edit.svg"
            alt="Edit"
            width="18"
            height="18"
            pTooltip="Update"
            tooltipPosition="top"
            (click)="uploadLeadFiles(leadData[0])"
            class="position-absolute me-2 edit-icon"
            style="top: 1rem; right: 1rem; cursor: pointer"
          />

          <!-- <h5 class="text-primary">GST Program</h5> -->
          <div>
            <div class="accordion-item">
              <div class="accordion-header d-flex justify-content-between align-items-center">
                <button
                  class="accordion-button fw-semibold collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#GSTCollapse"
                  aria-expanded="true"
                  aria-controls="GSTCollapse"
                >
                  GST Details
                </button>
                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#GSTCollapse"
                  aria-expanded="false"
                  aria-controls="GSTCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#GSTCollapse"
                  aria-expanded="false"
                  aria-controls="GSTCollapse"
                />
              </div>
              <div id="GSTCollapse" class="accordion-collapse collapse show">
                <div class="accordion-body card-bodysection">
                  <div class="">
                    <div class="detail-card">
                      <!-- <div class="info-line mt-2">
                        <div class="label d-flex justify-content-between">
                          Total GSTR-3B Sale<b>:&nbsp;</b>
                        </div>
                        <div class="value fw-bold text-primary">
                          {{ totalGst3BSale }}
                        </div>
                      </div> -->

                      <!-- <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                <div
                  *ngFor="
                    let account of leadDocuments?.gstDetails;
                    let i = index
                  "
                  class="business-details mt-3"
                >
                  <div class="label" style="text-decoration: underline">
                    Operating State-{{ i + 1 }}
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      State<b>:&nbsp;</b>
                    </div>
                    <div class="value">
                      {{ account.operatingState | capitalizeFirst }}
                    </div>
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      Filing Period<b>:&nbsp;</b>
                    </div>
                    <div
                      *ngIf="isValidDate(account.filingPeriod)"
                      class="value"
                    >
                      {{ account.filingPeriod | date }}
                    </div>
                  </div>

                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      GSTR-3B Sale<b>:&nbsp;</b>
                    </div>
                    <div class="value">{{ account.gst3BSale }}</div>
                  </div>
                  <div class="info-line">
                    <div class="label d-flex justify-content-between">
                      GSTR-3B Attachment<b>:&nbsp;</b>
                    </div>
                    <div class="value">
                      <div
                        *ngIf="
                          account?.gstDetails && account?.gstDetails.length > 0
                        "
                      >
                        <span
                          *ngFor="let file of account?.gstDetails"
                          class="me-2"
                        >
                          <a [href]="'//' + file" target="_blank"> View </a>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
                      <!-- <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                  <div
                    *ngFor="
                      let account of leadDocuments.gstDetails;
                      let i = index
                    "
                    class="business-details mt-3"
                  >
                    <div class="label" style="text-decoration: underline">
                      Operating State - {{ i + 1 }}
                    </div>

                    <div
                      class="info-line"
                      *ngFor="let field of gstAccountFields"
                    >
                      <div class="label d-flex justify-content-between">
                        {{ field.label }} <b>:&nbsp;</b>
                      </div>
                      <div class="value">
                        <ng-container *ngIf="field.key === 'filingPeriod'">
                          <ng-container
                            *ngIf="
                              isValidDate(account[field.key]);
                              else noValue
                            "
                          >
                            {{ account[field.key] | date }}
                          </ng-container>
                        </ng-container>

                        <ng-container *ngIf="field.key === 'gstDetails'">
                          <ng-container
                            *ngIf="
                              account?.gstDetails?.length > 0;
                              else noValue
                            "
                          >
                            <span
                              *ngFor="let file of account.gstDetails"
                              class="me-2"
                            >
                              <a [href]="'//' + file" target="_blank">View</a>
                            </span>
                          </ng-container>
                        </ng-container>

                        <ng-container
                          *ngIf="
                            field.key !== 'filingPeriod' &&
                            field.key !== 'gstDetails'
                          "
                        >
                          {{ account[field.key] || "-" }}
                        </ng-container>
                      </div>
                    </div>

                    <ng-template #noValue>-</ng-template>
                  </div>
                </div> -->

                      <div *ngIf="leadDocuments?.gstDetails?.length > 0">
                        <!-- Group GST data by operatingState -->
                        <div *ngIf="groupedGstData | keyvalue as states">
                          <!-- Loop states -->
                          <div *ngFor="let state of states">
                            <h5 class="mt-3">{{ state.key | titlecase }}</h5>

                            <!-- Loop years inside state -->
                            <div *ngFor="let year of state.value | keyvalue">
                              <h5 class="mt-2">Year: {{ year.key }}</h5>

                              <p-table
                                [value]="year.value"
                                responsiveLayout="scroll"
                                class="custom-dark-table"
                              >
                                <ng-template pTemplate="header">
                                  <tr>
                                    <th>Operating State</th>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th>Filing Period</th>
                                    <th>GSTR 3B Sale</th>
                                    <th>Attachments</th>
                                  </tr>
                                </ng-template>

                                <ng-template let-gst pTemplate="body">
                                  <tr>
                                    <td>{{ gst.operatingState }}</td>
                                    <td>{{ gst.year }}</td>
                                    <td>{{ gst.month }}</td>
                                    <td>
                                      {{
                                        isValidDate(gst.filingPeriod)
                                          ? (gst.filingPeriod
                                            | date : "MMM dd, yyyy")
                                          : "-"
                                      }}
                                    </td>
                                    <td>
                                      {{
                                        gst?.gst3BSale
                                          ? "" +
                                            (gst.gst3BSale | number : "1.2-2")
                                          : "-"
                                      }}
                                    </td>
                                    <td>
                                      <div class="d-flex flex-wrap gap-2">
                                        <a
                                          *ngFor="let file of gst.gstDetails"
                                          [href]="'//' + file"
                                          target="_blank"
                                        >
                                          <i
                                            [class]="
                                              getFileIcon(file.split('.').pop())
                                            "
                                            class="file-icon me-2"
                                          ></i>
                                        </a>
                                      </div>
                                    </td>
                                  </tr>
                                </ng-template>

                                <!-- Year total -->
                                <ng-template pTemplate="footer">
                                  <tr>
                                    <td colspan="3" class="text-end fw-bold">
                                      Total ({{ year.key }}):
                                    </td>
                                    <td colspan="3" class="fw-bold">
                                      {{
                                        getYearTotal(year.value)
                                          | number : "1.2-2"
                                      }}
                                    </td>
                                  </tr>
                                </ng-template>
                              </p-table>
                            </div>

                            <!-- State total -->
                            <div class="fw-bold mt-2">
                              State Total ({{ state.key }}): {{
                                getStateTotal(state.value) | number : "1.2-2"
                              }}
                            </div>
                          </div>

                          <!-- Grand total -->
                          <div class="p-3 mt-3 fw-bold">
                            Grand Total GST 3B Sale: {{
                              getGrandTotal() | number : "1.2-2"
                            }}
                          </div>
                        </div>
                      </div>

                      <div *ngIf="leadDocuments?.gstDetails == null">
                        <div class="text-center">
                          <div colspan="10" class="text-center fw-bold">
                            <!-- <img
                      alt="No Data"
                      src="../../../../assets/images/menu/no-data.gif"
                      width="200"
                      height="200"
                    /> -->
                            <p
                              style="
                                color: #535ab4;
                                font-weight: 400;
                                font-size: 18px;
                              "
                            >
                              No GST Details Found
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>
            <div class="accordion-item">
              <div class="accordion-headed d-flex justify-content-between align-items-center ">
                <button
                  class="accordion-button fw-semibold collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#supportingCollapse"
                  aria-expanded="true"
                  aria-controls="supportingCollapse"
                >
                  Calculation for GST Program
                </button>
                <img
                  src="assets/images/icons/downarrow.svg"
                  alt="down"
                  class="accordion-arrow arrow-down ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#supportingCollapse"
                  aria-expanded="false"
                  aria-controls="supportingCollapse"
                />
                <img
                  src="assets/images/icons/toparrow.svg"
                  alt="up"
                  class="accordion-arrow arrow-up ms-2"
                  role="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#supportingCollapse"
                  aria-expanded="false"
                  aria-controls="supportingCollapse"
                />
              </div>
              <div
                id="supportingCollapse"
                class="accordion-collapse collapse show"
              >
                <div class="accordion-body card-bodysection">
                  <div>
                    <div class="row">
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>GST Turnover:&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="gstTurnover"
                            class="custom-input"
                            placeholder="Enter GST Turnover"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>Margin Interest (%):&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="margin"
                            class="custom-input"
                            placeholder="Enter Margin"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="col-md-4 mt-2">
                        <div class="input-container">
                          <div class="my-1">
                            <label>FOIR (%):&nbsp;</label>
                          </div>
                          <input
                            pInputText
                            class="rounded-lg"
                            type="number"
                            [(ngModel)]="months"
                            class="custom-input"
                            placeholder="Enter FOIR"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-center mt-3">
                      <div class="me-3">
                        <button
                          pButton
                          pRipple
                          type="button"
                          class="p-button-primary"
                          (click)="calculateGstProgram()"
                        >
                          Calculate
                        </button>
                      </div>
                    </div>
                    <!-- <div
                  class="mt-3 fw-bold d-flex justify-content-center mt-3"
                  *ngIf="gstValue"
                >
                  <h6>
                    Eligible Emi in GST Program:<span
                      style="color: #8e89d0; font-weight: bold"
                    >
                      {{ gstValue }}</span
                    >
                  </h6>
                </div> -->

                    <div
                      class="mt-3 fw-bold d-flex justify-content-center"
                      *ngIf="gstValue"
                    >
                      <div class="text-center">
                        <h6>
                          Eligible EMI in GST Program:
                          <span style="color: #8e89d0; font-weight: bold">{{
                            gstValue
                          }}</span>
                        </h6>
                        <h6>
                          Loan Amount:
                          <span style="color: #8e89d0; font-weight: bold">{{
                            gstloanAmount
                          }}</span>
                        </h6>
                        <h6>
                          Tenure:
                          <span style="color: #8e89d0; font-weight: bold"
                            >{{ gstTenure }} months</span
                          >
                        </h6>
                        <h6>
                          Interest Rate:
                          <span style="color: #8e89d0; font-weight: bold"
                            >{{ gstInterest }} %</span
                          >
                        </h6>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Section: Credit Summary -->
        <div *ngIf="selectedSection === 6">
          <label>Credit Summary</label>
          <textarea
            pInputTextarea
            class="form-control"
            placeholder="Enter Credit Summary"
            [(ngModel)]="creditSummary"
            (blur)="onCreditSummaryChange()"
          ></textarea>
        </div>

        <!-- Buttons (bottom right) -->
        <div class="text-center mt-3">
          <!-- <button class="btn btn-primary me-2">Ready to Login</button>
          <button class="btn btn-outline-primary">Inhouse Reject</button> -->
          <div
            class="d-flex justify-content-center mt-3 readybutton"
            *ngIf="leadData"
          >
            <div class="me-3" *ngIf="leadData[0].leadInternalStatus == 5">
              <button
                pButton
                pRipple
                type="button"
                class="btn btn-primary me-2"
                (click)="sendLeadToReadyToLogin(leadData)"
              >
                Ready to Login
              </button>
            </div>
            <div *ngIf="leadData[0].leadInternalStatus == 5" class="raj">
              <button
                pButton
                pRipple
                type="button"
                class="btn btn-outline-primary"
                (click)="sendLeadToReject(leadData)"
              >
                In House Reject
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
